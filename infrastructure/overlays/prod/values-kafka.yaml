# gitops-platform/infrastructure/overlays/prod/values-kafka.yaml
# Production config: KRaft, persistence, TLS, monitoring

replicaCount: 3  # ✅ HA: 3 brokers for fault tolerance

image:
  registry: docker.io
  repository: apache/kafka
  tag: 4.1.1
  pullPolicy: IfNotPresent

persistence:
  enabled: true
  size: 100Gi
  storageClass: "gp3"

resources:
  requests:
    memory: 4Gi
    cpu: 2000m
  limits:
    memory: 8Gi
    cpu: 4000m

# ✅ KRaft mode (no Zookeeper)
kraft:
  enabled: true
  processRoles: "broker,controller"
  controllerQuorumVoters: "1@kafka-0.kafka-headless.infrastructure.svc.cluster.local:9093,2@kafka-1.kafka-headless.infrastructure.svc.cluster.local:9093,3@kafka-2.kafka-headless.infrastructure.svc.cluster.local:9093"

listeners:
  client:
    protocol: SASL_SSL  # ✅ Production: encrypted + authenticated
    containerPort: 9092
  controller:
    protocol: PLAINTEXT  # Internal controller comm can be PLAINTEXT on private network
    containerPort: 9093

# ✅ SASL/SCRAM auth via existing secret
sasl:
  enabled: true
  existingSecret: kafka-credentials
  clientUsers:
    - auth-service
    - payment-service

# ✅ TLS configuration
tls:
  enabled: true
  autoGenerated: false
  existingSecret: "kafka-tls-cert"

# ✅ Monitoring & metrics
metrics:
  enabled: true
  kafka:
    enabled: true
  jmx:
    enabled: true
  serviceMonitor:
    enabled: true

# ✅ Log retention for compliance
config:
  log:
    retention:
      hours: 168  # 7 days
  offset:
    retention:
      minutes: 10080  # 7 days